@if((userRole$ | async) == 'Admin'){
<div class="manage-orders-container">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <h1><i class="bi bi-bag-check"></i> Manage Orders</h1>
            <p class="subtitle">Track, update, and manage all customer orders</p>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-bar">
        <div class="search-box">
            <i class="bi bi-search"></i>
            <input type="text" placeholder="Search by order ID, customer name..." [(ngModel)]="searchTerm"
                (ngModelChange)="applyFilters()" />
        </div>
        <select class="status-filter" [(ngModel)]="statusFilter" (ngModelChange)="applyFilters()">
            <option value="">All Statuses</option>
            <option value="Pending">Pending</option>
            <option value="Processing">Processing</option>
            <option value="Shipped">Shipped</option>
            <option value="Delivered">Delivered</option>
            <option value="Cancelled">Cancelled</option>
        </select>
        <div class="date-range">
            <input type="date" [(ngModel)]="startDate" (ngModelChange)="applyFilters()" />
            <input type="date" [(ngModel)]="endDate" (ngModelChange)="applyFilters()" />
        </div>
    </div>

    <!-- Messages -->
    @if(successMessage){
    <div class="alert alert-success">
        <i class="bi bi-check-circle"></i> {{ successMessage }}
    </div>
    }
    @if(errorMessage){
    <div class="alert alert-error">
        <i class="bi bi-exclamation-circle"></i> {{ errorMessage }}
    </div>
    }

    <!-- Orders Section -->
    <div class="orders-section">
        @if(filteredOrders$ | async; as orders){
            @if(orders.length > 0){
            <div class="orders-wrapper">
                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon pending">
                            <i class="bi bi-hourglass-split"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Pending</span>
                            <span class="stat-value">{{ getPendingCount(orders) }}</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon processing">
                            <i class="bi bi-gear"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Processing</span>
                            <span class="stat-value">{{ getProcessingCount(orders) }}</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon shipped">
                            <i class="bi bi-truck"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Shipped</span>
                            <span class="stat-value">{{ getShippedCount(orders) }}</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon delivered">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Delivered</span>
                            <span class="stat-value">{{ getDeliveredCount(orders) }}</span>
                        </div>
                    </div>
                </div>

                <!-- Orders Table -->
                <table class="orders-table">
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for(order of orders; track order._id || $index){
                        <tr class="order-row" [class]="'status-' + (order.status | lowercase)">
                            <td class="order-id-cell">
                                <span class="order-id">#{{ order._id?.slice(-8)?.toUpperCase() }}</span>
                            </td>
                            <td class="customer-cell">
                                <span class="customer-name">{{ order.userId }}</span>
                            </td>
                            <td class="items-cell">
                                <span class="items-count">{{ order.products.length }} item(s)</span>
                            </td>
                            <td class="total-cell">
                                <span class="total-price">{{ order.totalPrice | currency }}</span>
                            </td>
                            <td class="status-cell">
                                <select class="status-select" [(ngModel)]="order.status" 
                                    (change)="updateOrderStatus(order._id!, order.status)">
                                    <option value="Pending">Pending</option>
                                    <option value="Processing">Processing</option>
                                    <option value="Shipped">Shipped</option>
                                    <option value="Delivered">Delivered</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </td>
                            <td class="date-cell">
                                {{ order.createdAt | date: 'MMM dd, yyyy' }}
                            </td>
                            <td class="actions-cell">
                                <button class="btn-view" (click)="openOrderDetails(order)" title="View Details">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <!-- <button class="btn-delete" (click)="deleteOrder(order._id!)" title="Delete Order">
                                    <i class="bi bi-trash"></i>
                                </button> -->
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
            }@else{
            <div class="no-orders">
                <i class="bi bi-inbox"></i>
                <p>No orders found</p>
            </div>
            }
        }
    </div>

    <!-- Order Details Modal -->
    @if(selectedOrder){
    <div class="modal-backdrop" (click)="closeOrderDetails()"></div>
    <div class="modal-container">
        <div class="modal-content">
            <!-- Modal Header -->
            <div class="modal-header">
                <h2>Order Details - #{{ selectedOrder._id?.slice(-8)?.toUpperCase() }}</h2>
                <button class="btn-close" (click)="closeOrderDetails()" type="button">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Order Info -->
                <div class="details-section">
                    <h4><i class="bi bi-info-circle"></i> Order Information</h4>
                    <div class="info-grid">
                        <div class="info-item">
                            <span class="label">Order ID:</span>
                            <span class="value">#{{ selectedOrder._id?.slice(-8)?.toUpperCase() }}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Customer ID:</span>
                            <span class="value">{{ selectedOrder.userId }}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Order Date:</span>
                            <span class="value">{{ selectedOrder.createdAt | date: 'MMM dd, yyyy - hh:mm a' }}</span>
                        </div>
                        <div class="info-item">
                            <span class="label">Status:</span>
                            <span class="value status-badge" [ngClass]="'status-' + (selectedOrder.status | lowercase)">
                                {{ selectedOrder.status }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Products List -->
                <div class="details-section">
                    <h4><i class="bi bi-box"></i> Items Ordered</h4>
                    <div class="products-list">
                        @for(product of selectedOrder.products; track product._id){
                        <div class="product-item">
                            <div class="product-info">
                                <span class="product-name">{{ product.productId.name }}</span>
                                <span class="product-qty">Quantity: {{ product.quantity }}</span>
                            </div>
                            <div class="product-price">
                                <span>${{ product.price.toFixed(2) }} each</span>
                                <span class="product-total">${{ (product.price * product.quantity).toFixed(2) }}</span>
                            </div>
                        </div>
                        }
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="details-section">
                    <h4><i class="bi bi-receipt"></i> Order Summary</h4>
                    <div class="summary-details">
                        <div class="summary-row">
                            <span class="label">Subtotal:</span>
                            <span class="value">${{ selectedOrder.subTotal.toFixed(2) }}</span>
                        </div>
                        <div class="summary-row">
                            <span class="label">Tax (10%):</span>
                            <span class="value">${{ selectedOrder.tax.toFixed(2) }}</span>
                        </div>
                        <div class="summary-row">
                            <span class="label">Shipping:</span>
                            <span class="value">${{ selectedOrder.shipping.toFixed(2) }}</span>
                        </div>
                        <div class="summary-row total">
                            <span class="label">Total Amount:</span>
                            <span class="value">{{ selectedOrder.totalPrice | currency }}</span>
                        </div>
                    </div>
                </div>

                <!-- Delivery Address -->
                <div class="details-section">
                    <h4><i class="bi bi-geo-alt"></i> Delivery Address</h4>
                    <div class="address-info">
                        <p class="address-line">
                            <span class="address-label">Street:</span>
                            <span class="address-value">{{ selectedOrder.addressId.street  }}</span>
                        </p>
                        <p class="address-line">
                            <span class="address-label">City:</span>
                            <span class="address-value">{{ selectedOrder.addressId.city }}</span>
                        </p>
                        <p class="address-line">
                            <span class="address-label">Zip Code:</span>
                            <span class="address-value">{{ selectedOrder.addressId.zipCode }}</span>
                        </p>
                        <p class="address-line">
                            <span class="address-label">Country:</span>
                            <span class="address-value">{{ selectedOrder.addressId.country }}</span>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button class="btn-close-modal" (click)="closeOrderDetails()">
                    <i class="bi bi-x"></i> Close
                </button>
            </div>
        </div>
    </div>
    }
</div>
}@else{
<div class="access-denied">
    <i class="bi bi-shield-exclamation"></i>
    <h2>Access Denied</h2>
    <p>Only administrators can access this page</p>
</div>
}
